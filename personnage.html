<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Fiche Personnage - The Hope Heritage</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">The Hope Heritage</div>
        <ul class="nav-links">
            <li><a href="index.html">Accueil</a></li>
            <li><a href="histoire.html">Histoire</a></li>
            <li><a href="systeme.html">Système de jeu</a></li>
            <li><a href="personnage.html">Fiches personnage</a></li>
        </ul>
    </nav>

    <main class="content-section">
    <h1>Fiche de : <span id="displayID">...</span></h1>
    
    <div class="card">
        <h2 class="section-title">État Civil</h2>
        <div class="grid-container">
            <div class="input-group"><label>Nom & Prénom</label><input type="text" id="nomComplet" class="save-field"></div>
            <div class="input-group"><label>Âge</label><input type="number" id="age" class="save-field"></div>
            <div class="input-group"><label>Faction</label><input type="text" id="faction" class="save-field"></div>
            <div class="input-group"><label>Pouvoir</label><input type="text" id="pouvoir" class="save-field"></div>
            <div class="input-group"><label>École de Combat</label><input type="text" id="ecoleCombat" class="save-field"></div>
            <div class="input-group"><label>Religion</label><input type="text" id="religion" class="save-field"></div>
        </div>

        <div class="grid-container">
            <section>
                <h2 class="section-title">Physique</h2>
                <div class="input-group"><label>Taille / Poids</label><input type="text" id="physique_tp" class="save-field"></div>
                <div class="input-group"><label>Yeux / Cheveux</label><input type="text" id="physique_yc" class="save-field"></div>
                <div class="input-group"><label>Style Vestimentaire</label><textarea id="styleVest" class="save-field"></textarea></div>
                <div class="input-group"><label>Traits Particuliers</label><textarea id="traitsPart" class="save-field"></textarea></div>
            </section>
            <section>
                <h2 class="section-title">Psychologie & Liens</h2>
                <div class="input-group"><label>Qualités</label><input type="text" id="qualites" class="save-field"></div>
                <div class="input-group"><label>Défauts</label><input type="text" id="defauts" class="save-field"></div>
                <div class="input-group"><label>Famille</label><textarea id="famille" class="save-field"></textarea></div>
                <div class="input-group"><label>Amis / Alliés</label><textarea id="amis" class="save-field"></textarea></div>
            </section>
        </div>

        <h2 class="section-title">Équipement de Combat</h2>
        <div class="input-group">
            <label>Arme principale portée</label>
            <input type="text" id="armePortee" class="save-field" placeholder="Nom et bonus de l'arme...">
        </div>

        <h2 class="section-title">Capacités & Grimoire</h2>
        
        <h3>Compétences</h3>
        <table class="dynamic-table"><tbody id="bodyCompetences"></tbody></table>
        <button class="btn-add" onclick="addRow('bodyCompetences', 2)">+ Ajouter une compétence</button>

        <h3>Talents</h3>
        <table class="dynamic-table"><tbody id="bodyTalents"></tbody></table>
        <button class="btn-add" onclick="addRow('bodyTalents', 2)">+ Ajouter un talent</button>

        <h3>Sorts</h3>
        <table class="dynamic-table">
            <thead><tr><th>Rang</th><th>Nom</th><th>Description</th><th></th></tr></thead>
            <tbody id="bodySorts"></tbody>
        </table>
        <button class="btn-add" onclick="addRow('bodySorts', 3)">+ Ajouter un sort</button>

        <h2 class="section-title">Inventaire</h2>
        <div class="money-section">
            <label><strong>Fortune (Noz) :</strong></label>
            <input type="number" id="argentNoz" class="save-field" style="width: 120px;">
        </div>
        <table class="dynamic-table">
            <thead><tr><th>Objet</th><th>Description</th><th>Qté</th><th></th></tr></thead>
            <tbody id="bodyInventaire"></tbody>
        </table>
        <button class="btn-add" onclick="addRow('bodyInventaire', 3)">+ Ajouter un objet</button>

        <h2 class="section-title">Histoire du Personnage</h2>
        <textarea id="histoirePerso" class="save-field" style="min-height: 250px;"></textarea>

        <p id="statut">Synchronisation...</p>
    </div>
</main>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // --- COLLE TON BLOC FirebaseConfig ICI ---
      // Import the functions you need from the SDKs you need
      const firebaseConfig = {
        apiKey: "AIzaSyAhl7MuvCy54F4Qt27mtlVAqmCu4Bg-KCE",
        authDomain: "the-hope-heritage.firebaseapp.com",
        projectId: "the-hope-heritage",
        storageBucket: "the-hope-heritage.firebasestorage.app",
        messagingSenderId: "472185106488",
        appId: "1:472185106488:web:496f37e901690987f536cd"
      };
    
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
    
      // --- LOGIQUE MULTI-JOUEURS ---
      // On récupère le nom du joueur dans l'URL (ex: ?id=Valerius)
      const urlParams = new URLSearchParams(window.location.search);
      let joueurID = urlParams.get('id');
    
      // Si pas d'ID dans l'URL, on demande le nom
      if (!joueurID) {
          joueurID = prompt("Entrez votre nom de personnage pour charger votre fiche :");
          if (!joueurID) joueurID = "Anonyme"; // Secours
      }
    
      // On pointe vers le document spécifique de CE joueur
      const persoRef = doc(db, "personnages", joueurID);
      
      // Afficher le nom du joueur sur la page
      document.querySelector('h1').innerText = "Fiche de : " + joueurID;
    
      const fields = ["nomPerso", "force", "endurance", "agilite", "dexterite", "perception", "mental", "intelligence", "sociabilite"];
    
      // Écouter le temps réel pour ce joueur précis
      onSnapshot(persoRef, (doc) => {
          if (doc.exists()) {
              const data = doc.data();
              fields.forEach(field => {
                  const el = document.getElementById(field);
                  if (document.activeElement !== el) {
                      el.value = data[field] || (field === "nomPerso" ? joueurID : 10);
                  }
              });
              document.getElementById("statut").innerText = "Connecté en tant que " + joueurID;
          }
      });
    
      // Sauvegarde automatique
      const sauvegarder = () => {
          const stats = {};
          fields.forEach(field => {
              const val = document.getElementById(field).value;
              stats[field] = field === "nomPerso" ? val : parseInt(val);
          });
          setDoc(persoRef, stats, { merge: true });
      };
    
      fields.forEach(field => {
          document.getElementById(field).addEventListener("input", sauvegarder);
      });
    </script>
</body>
</html>
